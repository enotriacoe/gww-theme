---
category:
    shop_by_price: false
    products:
        limit: {{theme_settings.categorypage_products_per_page}}
---
{{inject "categoryProductsPerPage" theme_settings.categorypage_products_per_page}}
{{#partial "head"}}
    {{#if pagination.category.previous}}
        <link rel="prev" href="{{pagination.category.previous}}">
    {{/if}}
    {{#if pagination.category.next}}
        <link rel="next" href="{{pagination.category.next}}">
    {{/if}}
{{/partial}}

{{#partial "page"}}

{{> components/common/breadcrumbs breadcrumbs=breadcrumbs}}

<div class="page">
    {{> components/category/category-header-no-divider}}

    <main class="page-content" id="product-listing-container">
        {{#if category.subcategories}}
            <div> 
                <ul class="group-list">
                    {{#each category.subcategories}}
                        <li><a href="{{url}}">{{name}}</a></li>
                    {{/each}}
                </ul>
            </div>
        {{/if}}
    </main>
</div>

{{/partial}}
{{> layout/base}}

<script>
    function displayProducers(dataReturned){
        // Get all of the countries from the API/Proxy
        if (dataReturned) {
            console.log(dataReturned);
            let producerList = dataReturned.data[0].children;
            let currentProducerName, currentProducerUrl;
            let producerDiv = document.querySelector('.group-list');
            producerDiv.innerHTML = "";
            
            // Loop through each country and display 
            for (let i = 0, length = producerList.length; i < length; i++){
                currentProducerName = producerList[i].name;
                currentProducerUrl = producerList[i].url;
                producerDiv.innerHTML = (producerDiv.innerHTML + "<li><a href='" + currentProducerUrl + "'>" + currentProducerName + "</a></li>"); 
            }
        }
    }

    fetch('https://bcapi.greatwesternwine.co.uk/catalog/flattened-categories/producers')
        .then(function(response) {
            return response.json();
        })
        .then(function(returnedJson) {
            displayProducers(returnedJson)
        });
</script>